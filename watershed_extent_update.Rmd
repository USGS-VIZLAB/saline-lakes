---
title: "End of Summer Report"
author: |
  | Vizlab, Data Science Branch, IIDD 
  | Contacts: Margaux Sleckman (msleckman@usgs.gov), Anthony Martinez (ajmartinez@usgs.gov) and Cee Nell (cnell@usgs.gov)
  
date: "9/01/2022"
output: html_document
---

The purpose of this document is to establish an agreed upon spatial extent for each of the saline lakes, including:

1. Lake polygons - incl. Carson Sink
2. Updated Watershed boundaries
3. Upstream flowlines within each watershed

Data source table: 

|Database: | Use:     |
| ---------|----------|
|[National Hydrological Dataset - high res](https://www.usgs.gov/national-hydrography/nhdplus-high-resolution) - water body attributes | X 


Definitions: 

Water body and watershed extent definitions:

  * **Lake boundary: ** Border of water body
  * **Lake boundary and Wetlands:** Broader outline of our focal lakes that includes lake wetlands
  * **Watershed Extents:**

```{r load_lbs, echo = FALSE, warnings = FALSE} 

library(targets)
library(leaflet)
library(scico)
library(scales)
library(tidyverse)
library(dplyr)
source('3_visualize/src/prep_viz_data.R')
source('3_visualize/src/interactive_map.R')

```


```{r load_targets, echo = FALSE, warnings = FALSE}

## HUC
tar_load(p1_get_lakes_huc6_sf)
tar_load(p1_get_lakes_huc8_sf)
tar_load(p1_get_lakes_huc10_sf)

## Lakes
tar_load(p2_saline_lakes_sf)
tar_load(p3_saline_lakes_sf)

## Watershed 
tar_load(p2_huc10_watershed_boundary)
tar_load(p2_huc10_watershed_boundary_no_humbolt_huc6)
tar_load(p2_lake_watersheds_dissolved)

## 
tar_load(p2_lake_tributaries)
tar_load(p3_flowlines_sf)

## Sites 
targets::tar_load(p3_gage_sites_sf)
targets::tar_load(p1_site_in_watersheds_sf)

```

```{r minor_processing, echo = FALSE, warnings = FALSE}

p2_lake_watersheds_dissolved_no_humbolt_huc6 <- p2_huc10_watershed_boundary_no_humbolt_huc6 %>% 
  group_by(lake_w_state) %>%
  summarize(geometry = sf::st_union(geom)) %>%
  ungroup()

```

You may explore the following map to visualize the different HUC areas within our basin and the final watershed extents determined after careful iteration on feedback. 


## Map 1 Huc 6 Lake basins
```{r huc_basins}

leaflet_map_huc <- leaflet() %>% 
  addProviderTiles("Esri.WorldGrayCanvas", group = c("No labels", "Labels"))  %>%
    #addProviderTiles("HERE.satelliteDay", group = c("No labels", "Labels"))  %>%
    addProviderTiles("CartoDB.PositronOnlyLabels", group = "Labels") %>%
    ## NOTE - compared to previos version of function - I've removed label param (no label column like below)
      # Add data layers (overlayGroups)
    addPolygons(data = p1_get_lakes_huc6_sf, group = "Great Basin HUC6",
                color = 'green', fillColor = "#C3CB9F", opacity = 0.4, weight = 1) %>% 
    addPolygons(data = p1_get_lakes_huc8_sf, group = "Great Basin HUC8",
                color = 'blue', fillColor = "#C3CB9F", opacity = 0.4, weight = 1) %>% 
    addPolygons(data = p1_get_lakes_huc10_sf, group = "Great Basin HUC10",
                color = '#3A6DB7', opacity = 0.4, weight = 1) %>% 
    addPolygons(data = p2_lake_watersheds_dissolved, group = "Watershed Extent",
                color = 'black', opacity = 0.4, weight = 3) %>% 
    addPolygons(data = p2_lake_watersheds_dissolved_no_humbolt_huc6, group = "Watershed Extent v2",
                color = 'black', fillColor = "#C3CB9F", opacity = 0.4, weight = 3) %>% 
    addPolygons(data = p3_saline_lakes_sf, group = "Saline lakes",
                color = '#3A6DB7', opacity = 0.6, weight = 1,
                popup = ~label) %>% 
      addLabelOnlyMarkers(data = p3_saline_lakes_sf, lng = ~X, lat = ~Y, group = "Lake labels",
                        label = ~lake_w_state,
                        labelOptions = labelOptions(noHide = T, textOnly = T)) %>% 
    # addLegend(data = , group = c("Gage sites"),
    #            title = "Within saline lake subbasin",
    #            pal = pal_gage, values = ~in_HUC8,
    #            position = "bottomright") %>%
  addLayersControl(baseGroups = c("Labels", "No Labels"),
                     overlayGroups = c("Great Basin HUC6", "Great Basin HUC8", "Great Basin HUC10",
                                       "Saline lakes", "Watershed Extent","Watershed Extent v2", 
                                       "Lake labels"),
                     position = "topright",
                     options = layersControlOptions(collapsed = F))

```
